## IPv6 つまみ食い

### 0. 目的

- IPv4 との違いをおさえる
- AWS で IPv6 を使うときの制約や独自のルールをおさえる

### 1. IPv6 アドレス

#### アドレスの構成

- 全 128 ビット
  - 16 ビットごとに「:」で区切る
  - 4 ビットごとに十六進表記
    - 例 : https://xtech.nikkei.com/it/free/v6start/road2_v6/20011202/6/zu2.gif （上）

#### アドレスの表記

- 長いので、省略形の表記ルールがある
  - RFC 4291
    - 16 ビット区切りのフィールドの先頭で連続する「0」は省略可
      - 例 : 2001:0db8:11aa:22bb:33cc:44ee:55ff:0006 → 2001:db8:11aa:22bb:33cc:44ee:55ff:6
    - 複数の 16 ビットフィールドで「0」が連続する場合は「::」で省略可
      - ただし「::」で省略できるのは 1 箇所のみ
      - 例 : 2001:0db8:0000:0000:0000:0002:0000:0001 → 2001:db8::2:0:1（または 2001:db8:0:0:0:2::1）
    - IPv4 アドレスが埋め込まれた特殊な IPv6 アドレスは、上位 6 個の 16 ビットフィールドを「:」区切り十六進表記、下位 32 ビットを「.」区切り十進表記
      - 例 : 0:0:0:0:FFFF:129.144.52.38
      - この場合も ::FFFF:129.144.52.38 という圧縮表記が可能
  - RFC 5952 : 一意な表記にする方法
    - RFC 4291 では同じアドレスを表記するのに複数の表記方法が可能になりうるため、一意な表記にする方法が RFC 5952 で規定されている
      - 「::」短縮時には可能な限り短く表記する
        - 例 : 2001:db8::0:2:1 のような表記をしない
      - 16 ビットフィールドの「0」が 1 つだけの場合は「::」を使わない
        - 例 : 2001:db8:0:1:1:1:1:1 を 2001:db8::1:1:1:1:1 と表記しない
      - 最も短縮できる箇所で「::」を使う
        - RFC 4291 で示した例では 2001:db8::2:0:1 のほうを採用する
      - 同じ長さの「16 ビットの 0」がある場合は、最初の箇所で「::」を使う
      - アルファベットは lower case で
      - IPv4 アドレスが埋め込まれた特殊な IPv6 アドレスは、先頭部分の「0」の連続を「::」で短縮する
        - 例 : RFC 4291 で例示したアドレスは ::ffff:192.0.2.1
      - ポート番号との表記で区切りに「:」を使うときは IPv6 アドレス部分を「[]」で括る（推奨）
        - 例 : \[2001:db8::1\]:80
        - RFC 3986 で示された表記

#### アドレスの種類

- リンクローカルユニキャストアドレス : 直接やり取り可能な範囲（リンクローカル）との間で通信を行うアドレス
  - fe80::/10
- マルチキャストアドレス : 単一のホストではなく複数のホストに同時に送信するためのアドレス
  - ff00::/8
  - IPv6 では IPv4 のブロードキャストアドレスの代わりに使われるケースが増加
- ループバックアドレス
  - ::1/128
  - 1 個だけになった
- 未定義アドレス
  - ::/128
  - アドレスが割り当てられていない状態
- グローバルユニキャストアドレス : インターネット通信用アドレス（パブリックアドレス）
  - 上記以外のアドレス範囲
    - 実際には組織に割り当てずに特定目的用に予約されているアドレス範囲もある
- ユニークローカルユニキャストアドレス（ULA）: 組織内のみで通信するためのアドレス（ルータ越え可能）
  - fc00::/7
    - うち、fc00::/8 は未定義（将来のために予約）なので fd00::/8 を使う
      - 8 ～ 47 ビット目はグローバル ID と呼び、ランダムに割り当てる
      - 48 ～ 63 ビット目はサブネット ID
  - グローバルユニキャストアドレスの一部だが、インターネットへのルーティングを前提としていない
  - インターネットへの接続を行う場合は NAT / NAPT でグローバルユニキャストアドレスに変換するのではなく、別のグローバルユニキャストアドレスを同一ホストに割り当ててそちらでインターネットへ通信する
  - AWS の VPC では使えない

#### アドレスの割り当て方法

### 2. ホスト間通信の方法

#### 同一ネットワーク内

#### 別ネットワーク間

#### IPv4 アドレス空間にアクセスする方法

#### IPv4 と IPv6 の共存

### 3. DNS

#### IPv6 専用レコード

#### DNS64（NAT64 と併用）

### 4. AWS の IPv6 VPC における制約
